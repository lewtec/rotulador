[tools]
"github:sqlc-dev/sqlc" = "1.30.0"
go = "1.25.5"
"go:github.com/nicksnyder/go-i18n/v2/goi18n" = "2.6.1"
"go:golang.org/x/tools/cmd/goimports" = "latest"
golangci-lint = "2.8.0"
node = "24"

[tasks.install]
description = "Install dependencies"
run = """
go mod download
npm install
"""

[tasks.codegen]
description = "Generate all assets"
depends = ["codegen:*"]

[tasks."codegen:css"]
description = "Generate CSS from Tailwind"
run = "npm run build:css"

[tasks."codegen:sqlc"]
description = "Generate Go code from SQL queries using sqlc"
run = "sqlc generate"

[tasks."codegen:i18n"]
description = "Extract and merge i18n strings"
run = """
echo "→ Extracting translatable strings..."
goi18n extract -format json -outdir .
echo "→ Merging with existing translations..."
goi18n merge -format json -outdir annotation/locales active.en.json annotation/locales/*.json
rm -f active.en.json
echo "✓ i18n files updated. Check annotation/locales/translate.*.json for new strings to translate."
"""

[tasks.lint]
description = "Run all linters"
depends = ["lint:*"]

[tasks."lint:go"]
description = "Lint Go code"
run = "golangci-lint run"

[tasks."lint:prettier"]
description = "Lint code with Prettier"
run = "npx prettier --check ."

[tasks.fmt]
description = "Format all code"
depends = ["fmt:*"]

[tasks."fmt:go"]
description = "Format Go code"
run = "goimports -w -l ."

[tasks."fmt:prettier"]
description = "Format code with Prettier"
run = "npx prettier --write ."

[tasks.test]
description = "Run tests"
depends = ["test:*"]

[tasks."test:go"]
description = "Run Go tests (scoped)"
run = "go test -v -race -coverprofile=coverage.out ./annotation/... ./internal/..."

[tasks."test:report"]
description = "Generate coverage report"
run = """
go tool cover -html=coverage.out -o coverage.html
echo "✓ Coverage report generated: coverage.html"
"""

[tasks.ci]
description = "Run CI checks"
depends = ["lint", "test"]

[tasks.build]
description = "Build the binary"
run = "go build -v -o rotulador ./cmd/rotulador"

[tasks.clean]
description = "Clean build artifacts"
run = """
rm -f rotulador coverage.out coverage.html
echo "✓ Cleaned"
"""
