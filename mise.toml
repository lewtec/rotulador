[tools]
"github:sqlc-dev/sqlc" = "1.30.0"
go = "1.25.5"
"go:github.com/nicksnyder/go-i18n/v2/goi18n" = "2.6.1"
golangci-lint = "2.8.0"
node = "24"

[tasks.gen]
description = "Generate all assets"
depends = ["gen:*"]

[tasks."gen:css"]
description = "Generate CSS from Tailwind"
run = "npm run build:css"

[tasks."gen:sqlc"]
description = "Generate Go code from SQL queries using sqlc"
run = "sqlc generate"

[tasks."gen:i18n"]
description = "Extract and merge i18n strings"
run = """
echo "→ Extracting translatable strings..."
goi18n extract -format json -outdir .
echo "→ Merging with existing translations..."
goi18n merge -format json -outdir annotation/locales active.en.json annotation/locales/*.json
rm -f active.en.json
echo "✓ i18n files updated. Check annotation/locales/translate.*.json for new strings to translate."
"""

[tasks.lint]
description = "Run linters"
run = "golangci-lint run"

[tasks.ci]
description = "Run CI checks (gen + lint + test + build)"
depends = ["gen", "lint", "test"]
run = "go build -v ./cmd/rotulador"

[tasks.test]
description = "Run all tests with coverage"
depends = ["gen"]
run = """
go test -v -race -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html
echo "✓ Coverage report generated: coverage.html"
"""

[tasks."test-short"]
description = "Run short tests (no integration tests)"
depends = ["gen"]
run = "go test -short -v ./..."

[tasks.build]
description = "Build the binary"
run = "go build -v -o rotulador ./cmd/rotulador"

[tasks.clean]
description = "Clean build artifacts"
run = """
rm -f rotulador coverage.out coverage.html
echo "✓ Cleaned"
"""
